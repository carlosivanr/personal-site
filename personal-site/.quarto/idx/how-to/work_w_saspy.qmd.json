{"title":"Work with SASPy","markdown":{"yaml":{"title":"Work with SASPy","html":{"toc":true},"execute":{"eval":true},"jupyter":"py_env"},"headingText":"Initiate a session","containsRefs":false,"markdown":"\n\n\n\nOnce SASPy is configured the first step in working with SASPy is to initiate a session. This will launch a SAS session in the background that will be available to run statistical analyses on any input data. \n```{python}\n# Data manipulation\nimport pandas as pd\n\n# Module with sample data set\nimport bambi as bmb\n\n# Interface with SAS\nimport saspy\n\n# Loads a custom function\nfrom my_fx.utilities import format_pval_df\n```\n\n```{python}\nsas = saspy.SASsession(cfgname = 'autogen_winlocal')\n```\n\n# Load an example data set\n```{python}\ndata = bmb.load_data(\"sleepstudy\")\n```\n\n```{python}\ndata.head()\n```\n\n# Send data to SAS\nThe next step in working with SASPy is to send a Pandas data frame to SAS. This command will send the data frame \"data\" to the background SAS session. Before sending data to SAS, it may be a good idea to double check that SAS has the proper formatting for dates and that the values, if categorical are recoded to comply with SAS column and value conventions. By default this data will be named _df and will be found in the work library\n\n```{python}\nsas_data = sas.df2sd(data, verbose = False)\n```\n\n# Submit SAS commands\nThe main functions to submit sas commands on data that is available in the sas session are `sas.submit()` and `sas.submitLST()`. The primary difference is that the LST version of the function will display the log and any output in the viewer when working in Positron. I personally use the LST version of the function to ensure that the SAS procedures are running correctly. When it is determined that the SAS procedures are running correctly. I then will remove the LST and then extract the tables from SAS to display in a Quarto document.  To save the output of SAS procedures I use ods output statements as in the example below. \n```{python}\n# Use sas.submitLST() to display output in viewer in an interactive session,\n# but use sas.submit() when rendering a .qmd document.\nc = sas.submit(\n\"\"\"\nods output Tests3=type3_results;\n\nproc mixed data = work._df;\n  class Subject Days;\n  model Reaction = Days;\n  random intercept/subject = Subject;\nrun;\n\"\"\")\n```\n\n\n# Retrieve ods output tables from SAS\nIn the code chunk above, we set ods output to save the Type 3 sums of squares results to a table named type3_results. We can then retrieve that table from SAS into our Python environment. Once in the Python environment, the tables can be formatted to your liking and purpose. Here's an example of how to format the Test3 table using a custom function to format the p-values.\n\n```{python}\ntype3_results = sas.sasdata(\"type3_results\", libref = \"work\").to_df()\n\n# Format the p values\ntype3_results[\"ProbF\"] = format_pval_df(type3_results['ProbF'])\n\n# Round all numberical values, set index and display\ntype3_results.round(2).set_index(\"Effect\")\n```\n","srcMarkdownNoYaml":"\n\n\n\n# Initiate a session\nOnce SASPy is configured the first step in working with SASPy is to initiate a session. This will launch a SAS session in the background that will be available to run statistical analyses on any input data. \n```{python}\n# Data manipulation\nimport pandas as pd\n\n# Module with sample data set\nimport bambi as bmb\n\n# Interface with SAS\nimport saspy\n\n# Loads a custom function\nfrom my_fx.utilities import format_pval_df\n```\n\n```{python}\nsas = saspy.SASsession(cfgname = 'autogen_winlocal')\n```\n\n# Load an example data set\n```{python}\ndata = bmb.load_data(\"sleepstudy\")\n```\n\n```{python}\ndata.head()\n```\n\n# Send data to SAS\nThe next step in working with SASPy is to send a Pandas data frame to SAS. This command will send the data frame \"data\" to the background SAS session. Before sending data to SAS, it may be a good idea to double check that SAS has the proper formatting for dates and that the values, if categorical are recoded to comply with SAS column and value conventions. By default this data will be named _df and will be found in the work library\n\n```{python}\nsas_data = sas.df2sd(data, verbose = False)\n```\n\n# Submit SAS commands\nThe main functions to submit sas commands on data that is available in the sas session are `sas.submit()` and `sas.submitLST()`. The primary difference is that the LST version of the function will display the log and any output in the viewer when working in Positron. I personally use the LST version of the function to ensure that the SAS procedures are running correctly. When it is determined that the SAS procedures are running correctly. I then will remove the LST and then extract the tables from SAS to display in a Quarto document.  To save the output of SAS procedures I use ods output statements as in the example below. \n```{python}\n# Use sas.submitLST() to display output in viewer in an interactive session,\n# but use sas.submit() when rendering a .qmd document.\nc = sas.submit(\n\"\"\"\nods output Tests3=type3_results;\n\nproc mixed data = work._df;\n  class Subject Days;\n  model Reaction = Days;\n  random intercept/subject = Subject;\nrun;\n\"\"\")\n```\n\n\n# Retrieve ods output tables from SAS\nIn the code chunk above, we set ods output to save the Type 3 sums of squares results to a table named type3_results. We can then retrieve that table from SAS into our Python environment. Once in the Python environment, the tables can be formatted to your liking and purpose. Here's an example of how to format the Test3 table using a custom function to format the p-values.\n\n```{python}\ntype3_results = sas.sasdata(\"type3_results\", libref = \"work\").to_df()\n\n# Format the p values\ntype3_results[\"ProbF\"] = format_pval_df(type3_results['ProbF'])\n\n# Round all numberical values, set index and display\ntype3_results.round(2).set_index(\"Effect\")\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"output-file":"work_w_saspy.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.36","theme":"cosmo","title":"Work with SASPy","html":{"toc":true},"jupyter":"py_env"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}